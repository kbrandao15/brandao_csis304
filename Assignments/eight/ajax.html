<html>
   <head>
      <title>Assignment Eight</title>

   <script type="text/javascript">

     // The URL we'll pull data from
     var theURL = "https://graphical.weather.gov/xml/sample_products/browser_interface/ndfdBrowserClientByDay.php?zipCodeList=97132&format=24+hourly&numDays=7";
     /**
      * A simple callback function to display some results from an
      * Ajax call. Note that 'this' in the context of the function will
      * be an XMLHttpRequest object at runtime
      */
     function aSimpleCallback()
     {
        // If the request was successfull, put the response into
        // an area on the web page
        if (this.readyState==4 && this.status==200)
        {
           // Creates a DOMParser and parses the response as XML and then grabs
           // some attributes (max/min temps, images, warnings) from the document
           parser = new DOMParser();
           xmlDoc=parser.parseFromString(this.responseText,"text/xml");
           var element;  
           // Loop through the temperature max and min
           for (var i = 0; i < 2; i++)
           {  
              for (var j = 0; j < 7; j++)
              {
                 if (xmlDoc.getElementsByTagName("temperature")[i] !== undefined)
                 {
                    element = xmlDoc.getElementsByTagName("temperature")[i].getElementsByTagName("value")[j].firstChild;  
                 
                    if (element !== null)
                    {
                       document.getElementById("temp"+i+""+j).innerHTML = element.nodeValue;  
                    }  
                    else 
                    {
                      document.getElementById("temp"+i+""+j).innerHTML = "-";  
                    }
                 }
                 else 
                 {
                   document.getElementById("zip").placeholder="please enter a valid zipcode";  
                 }
              }
             }
           // NOTE: if the data we want is not in an attribute of the
           // tag, but rather embedded within the tag
           // (e.g., <name>Foo</name>) then we can access it with
           // xmlDoc.getElementsByTagName("name")[0].firstChild or
           // xmlDoc.getElementsByTagName("name")[0].childNodes[0]
        }
     }


     /**
      * Generic function to make an asynchronous call to the given URL
      * and call the given function to process the results
      *
      * param url to retrieve
      * param callbackFunction to invoke when done retrieving
      */
     function makeAsynchRequest(url, callbackFunction)
     {
         // code for IE7+, Firefox, Chrome, Opera, Safari
         if (window.XMLHttpRequest)
         {
            xmlhttp=new XMLHttpRequest();
         }
         else // code for IE6, IE5
         {
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
         }

         // Create an anonymous function as the "callback" function
         // to be executed when the request finishes
         xmlhttp.onreadystatechange=callbackFunction;

         // Get the request, encoding the URL to ensure that any
         // parameters it includes do not confuse the proxy
         xmlhttp.open("GET","proxy.php?mode=native&url="+
               encodeURIComponent(url), true);
         xmlhttp.send();
     }

     function setURL(zip)
     {
        theURL = "https://graphical.weather.gov/xml/sample_products/browser_interface/ndfdBrowserClientByDay.php?zipCodeList="+zip+"&format=24+hourly&numDays=7";
        makeAsynchRequest(theURL, aSimpleCallback);
     }
   </script>

   </head>

   <body>

   <h1>7-Day Weather Forecast</h1>
   
   <label> ZipCode: <input type="text" id="zip" name="zipcod" placeholder="97132" onchange="setURL(this.value);"/> </label>
   <table> 
       <tr> 
         <td><img id="image1"> </img></td>
         <td><img id="image2"> </img></td>
         <td><img id="image3"> </img></td>
         <td><img id="image4"> </img></td>
         <td><img id="image5"> </img></td>
         <td><img id="image6"> </img></td>
         <td><img id="image7"> </img></td>
      </tr><tr>
         <td id="temp00"> </td>
         <td id="temp01"> </td>
         <td id="temp02"> </td>
         <td id="temp03"> </td>
         <td id="temp04"> </td>
         <td id="temp05"> </td>
         <td id="temp06"> </td>
     </tr><tr>
         <td id="temp10"> </td>
         <td id="temp11"> </td>
         <td id="temp12"> </td>
         <td id="temp13"> </td>
         <td id="temp14"> </td>
         <td id="temp15"> </td>
         <td id="temp16"> </td>
     </tr><tr>
         <td id="warn0"> </td>
         <td id="warn1"> </td>
         <td id="warn2"> </td>
         <td id="warn3"> </td>
         <td id="warn4"> </td>
         <td id="warn5"> </td>
         <td id="warn6"> </td>
     </tr>
   <div id="xmlResponse"></div>


   <script type="text/javascript">
      // Here we make a request and have it call the callback function
      makeAsynchRequest(theURL, aSimpleCallback);
   </script>


   </body>
</html>
